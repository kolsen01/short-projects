<!DOCTYPE html>
<html>

	<head>
		<title> My Location </title>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" href="style.css" />

		<script src="https://maps.google.com/maps/api/js?sensor=true"></script>

		<script> 
			var lat = 0;
			var long = 0;
			var	me = new google.maps.LatLng(lat, long);
			var map;

			var parameters; // login +latlng
			var JSONresponse;
			var url = 'https://defense-in-derpth.herokuapp.com/sendLocation' //creating var for url

			//Post request
			var xhr = new XMLHttpRequest();					
			xhr.open("POST", url, true);
			xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

			var infowindow = new google.maps.InfoWindow();	

			//gets my location
			function mylocation() {
				if (navigator.geolocation) {	
					navigator.geolocation.getCurrentPosition(function(position) {
						lat = position.coords.latitude;
						long = position.coords.longitude;

						parameters = 'login=yH2jVivG&lat=' + lat + '&long='	+ long;
						xhr.send(parameters);
						xhr.onreadystatechange = function() {
							if (xhr.readyState == 4 && xhr.status == 200) {
								JSONresponse = JSON.parse(xhr.responseText);
							}	
						}
					createMap(JSONresponse);	
					});
				}
			}			

			//creates map
			function createMap(JSONresponse) {
				me = new google.maps.LatLng(lat, long);

				map = new google.maps.Map(document.getElementById('map_canvas'), {
					position: me,
					zoom: 13,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				});

				map.panTo(me);
				
				var marker = new google.maps.Marker({ //marker
					position: me,
					title: "me"
				});

				marker.setMap(map);

				google.maps.event.addListener(marker, 'mouseover', function() {
					infowindow.setContent(this.title);
					infowindow.open(map, this);
				});

				google.maps.event.addListener(marker, 'mouseout', function() {
					infowindow.close();
				});	

				find_people_loc(JSONresponse);
			}

			//creates map local landmarks
			function find_landmarks(JSONresponse) {
				var points = []; //represents marker but for multiple places

				var pointLat = position.coords.latitude;
				var pointLong = position.coords.longitude;

				google.maps.event.addListener(marker, 'mouseover', function() {
					infowindow.setContent(this.title);
					infowindow.open(map, this);
				});

				google.maps.event.addListener(marker, 'mouseout', function() {
					infowindow.close();
				});	

			}

			//init, calls mylocation()
			function init() {
				var body = document.getElementById('map_canvas');
				body.innerHTML = "<h3> Loading ... </h3>";
				mylocation();
			}

	</script>

	</head>	
	
	<body onload="init()">
		<div id='map_canvas'> Trying to determine location... </div>
	</body>

</html>