<!DOCTYPE html>
<html>

	<head>
		<title> My Location </title>
		<meta charset="utf-8">

		<script> 
		var lat = -99999;
		var long = -99999;

				function mylocation() {
					if (navigator.geolocation) {
						navigator.geolocation.getCurrentPosition(function(position) {
							lat = position.coords.latitude;
							long = position.coords.longitude;
							printLocation();
						});

					}
				}	

				function printLocation() {
					elem = document.getElementById("location");
					elem.innerHTML = "<p>" + lat + ", " + long + "</p>";
				}	
				
		</script>
	
		<script>
				function loadMessages() {

					var xhr = new XMLHttpRequest();
					xhr.open("GET", "location.json", true);
					xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

					console.log("Hit me 1");

					xhr.onreadystatechange = function() {
						console.log("Hit me 2");

						if (xhr.readyState == 4 && xhr.status == 200) {

							rawData = xhr.responseText;
							messages = JSON.parse(rawData);
							output = "<ul>";
							for (count = 0; count < messages.length; count++) {
								output += "<li>" + messages[count].content + " => " + messages[count].username + "</li>";
							}
							output += "</ul>";
							document.getElementById("messages").innerHTML = output;
						}

						else if (xhr.readyState ==4 && xhr.status !=200) {
							document.getElementById("messages").innerHTML = "<p> No </p>";
						}
					}
					console.log("Hit me 3");

					xhr.send("location.json");
					console.log("Hit me 4");
				}		

		</script>

	</head>	
	
	<body onload= "mylocation()">
		<h1> Where Am I? </h1>
			<div id="location"> Looking... </div>
	</body>


	<body onload="loadMessages()">
		<h1>Messages</h1>
		<div id="messages">Loading...</div>	
	</body>	

</html>