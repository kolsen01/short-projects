<!DOCTYPE html>
<html>

	<head>
		<title> My Location </title>
		<meta charset="utf-8">

		<script> 
		var lat = -99999;
		var long = -99999;

				function mylocation() {
					if (navigator.geolocation) {
						navigator.geolocation.getCurrentPosition(function(position) {
							lat = position.coords.latitude;
							long = position.coords.longitude;
							printLocation();
						});

					}
				}	

				function printLocation() {
					elem = document.getElementById("location");
					elem.innerHTML = "<p>" + lat + ", " + long + "</p>";
				}	
				
		</script>
	

		<script>
				function loadMessages() {
					// Step 1: Make an instance of XMLHttpRequest
					var xhr = new XMLHttpRequest();
					// Step 2: Set up HTTP request
					xhr.open("GET", "https://defense-in-derpth.herokuapp.com/sendLocation", true);

					xhr.setRequestHeader('POST', 'https://defense-in-derpth.herokuapp.com/sendLocation');

					console.log("Hit me 1");
					// Step 3: Set up callback on what to do when response is received
					xhr.onreadystatechange = function() {
						console.log("Hit me 2");
						// Step 3A: get the response text if and only if readyState is 4
						if (xhr.readyState == 4 && xhr.status == 200) {
							// Step 5: do something with the response data (i.e., the JSON)
							rawData = xhr.responseText;
							messages = JSON.parse(rawData);
							output = "<ul>";
							for (count = 0; count < messages.length; count++) {
								output += "<li>" + messages[count].content + " => " + messages[count].username + "</li>";
							}
							output += "</ul>";
							document.getElementById("messages").innerHTML = output;
						}
					}
					console.log("Hit me 3");
					// Step 4: Fire off the request
					xhr.send("login=yH2jVivG&lat=42.3493298&long=-71.0799396");
					console.log("Hit me 4");
				}		

		</script>

	</head>	
	
	<body onload= "mylocation()">
		<h1> Where Am I? </h1>
			<div id="location"> Looking... </div>
	</body>


	<body onload="loadMessages()">
		<h1>Messages</h1>
		<div id="messages">Loading...</div>	
	</body>	

</html>