<!DOCTYPE html>
<html>

	<head>
		<title> My Location </title>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

		<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true"></script>

		<script> 
			var lat = -99999;
			var long = -99999;
			var me;
			var map;
			var parameters;
			var JSONresponse;
			var url= 'https://defense-in-derpth.herokuapp.com/sendLocation' //creating var for url


			//Post request
			var xhr = new XMLHttpRequest();					
			xhr.open("POST", url, true);
			xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

				//mapTypeId: google.maps.MapTypeId.ROADMAP

			//var infowindow = new google.maps.InfoWindow();	

			function mylocation() {
				navigator.geolocation.getCurrentPosition(function(position) {
					lat = position.coords.latitude;
					long = position.coords.longitude;	
					parameters = 'login=kolsen01&lat=' + lat + '&long='	+ long;
					xhr.send(parameters);
					//printLocation();
					xhr.onreadystatechange = function() {
						if (xhr.readyState == 4 && xhr.status == 200) {
							JSONresponse = JSON.parse(xhr.responseText);
							//output = "<ul>";
							/*for (count = 0; count < messages.length; count++) {
									output += "<li>" + messages[count].content + " => " + messages[count].username + "</li>";
								}
								output += "</ul>";
								document.getElementById("messages").innerHTML = output;
							}*/

							me = new google.maps.LatLng(lat, long);
							createMap(JSONresponse);
					};	
				}
			})	
		}	
	

			/* function printLocation() {
				elem = document.getElementById("location");
				elem.innerHTML = "<p>" + lat + ", " + long + "</p>";
			}
			*/

			//creates map
			function createMap(JSONresponse)
			{			
				me = new google.maps.Map(document.getElementById('map_canvas'), {
					center: me,
					zoom: 13
				});

				map.panTo(me);
				
				var marker = new google.maps.Marker({ //market
					position: me,
					title: "kolsen"
				});
					
				// Open info window on click of marker
				google.maps.event.addListener(marker, 'click', function() {
					infowindow.setContent(this.title);
					infowindow.open(map, this);
				});

				google.maps.event.addListener(marker, 'click', function() {
					infowindow.close();
				});	

				marker.setMap(map);
			}

/*			function loadMessages() {

					else if (xhr.readyState ==4 && xhr.status !=200) {
						document.getElementById("messages").innerHTML = "<p> Nope </p>";
					}

*/
			function init() {
				var body = document.getElementById('map_canvas');
				body.innerHTML = "<h1> Loading ...</h1>";
				mylocation();
			}

	</script>

	</head>	
	
	<body onload="init()">
		<div id='map_canvas'> Trying to determine location... </div>
	</body>

</html>